# Публикация приложения C# в CLI
У нас есть замечательное приложение ex0006VSCodeProject02 выводящее информацию об ОС в которой оно запущено.
Его и будем публиковать

## Публикация автономного приложения C# для Linux x64
Перейдите в каталог приложения и дайте там команду:

`dotnet publish -r linux-x64 -p:PublishSingleFile=true -p:PublishTrimmed=true --self-contained true`

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI01.png){ border-effect="line"  thumbnail="true" width="700"}

Да команда немного длинновата :), но что делать падаван, селяви, таков путь!

Скомпилированное приложение находится по пути подчеркнутому красной линией. Если зайти в этот каталог, то мы увидим
следующее:

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI02.png){ border-effect="line"  thumbnail="true" width="700"}

Поздравляю вы опубликовали своё первое автономное приложение для Linux x64!

Напомню ещё раз, что автономное означает, что оно может быть запущено на целевой ОС (в данном случае Linux x64)
без установки .NET Runtime в ней. Исполняемые файлы в Linux, как правило, не имеют расширения. У них есть атрибут,
что они могут выполняться. Сейчас что-то может быть вам всё ещё не понятно, но практика развеет туман невежества.

>Чтобы выполнить следующую часть упражнения у вас должен быть установлен сервер Ubuntu 22.04 на виртуальной или реальной
> машине, к которой вы имеете доступ по ssh. И на этом сервере Ubuntu не должен быть установлен .NET Framework.
{style = note}

У меня сервер Ubuntu 22.04 установлен на виртуальной машине и имеет IP 192.168.10.22.

Давайте перейдем в каталог куда был сохранён опубликованный файл и закинем его на сервер Ubuntu. Для этого последовательно
дадим команды:

`cd bin\Release\net8.0\linux-x64\publish`

`scp -r ex0006VSCodeProject02 itpro@192.168.10.22:/home/itpro`

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI03.png){ border-effect="line"  thumbnail="true" width="700"}

Первой командой мы перешли в каталог где находится опубликованная программа, а второй скопировали файл нашей программы на
сервер Ubuntu.

Теперь подключимся к серверу Ubuntu по ssh, проверим что там нет установленного .NET Runtime, и запустим нашу программу.

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI04.png){ border-effect="line"  thumbnail="true" width="700"}

Теперь нам осталось сделать файл программы исполняемым в Linux и запустить его. Все команды показаны и объяснены на скриншоте
ниже.

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI05.png){ border-effect="line"  thumbnail="true" width="700"}

## Публикация приложения C# зависимого от среды исполнения
Для публикации этого типа приложения команда очень простая:

`dotnet publish`

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI06.png){ border-effect="line"  thumbnail="true" width="700"}

Файлы нашей программы будут располагаться в каталоге подчеркнутым красной линией.

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI07.png){ border-effect="line"  thumbnail="true" width="700"}

Теперь нам на сервер Ubuntu надо закинуть всю эту папку. Но в данном случае, приложение может быть выполнено и в Windows,
и в macOS, и в Linux, но при условии, что там установлен .NET Runtime. Давайте убедимся в этом, для чего перейдем в каталог,
куда было опубликовано наше приложение и запустим его.

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI08.png){ border-effect="line"  thumbnail="true" width="700"}

Как видите наше приложение прекрасно работает, но только потому что на нашей машине установлен .NET SDK, который в себя
включает и .NET Runtime.

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI09.png){ border-effect="line"  thumbnail="true" width="700"}

Теперь нам на сервер Ubuntu нужно закинуть всю папку publish, так как это все файлы приложения. Для этого дадим команды:

`cd ..`

`scp -r publish\ itpro@192.168.10.22:/home/itpro`

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI10.png){ border-effect="line"  thumbnail="true" width="700"}

Первой командой мы поднимаемся на каталог выше, а второй копируем каталог publish и всё его содержимое на сервер Ubuntu.
В домашней папке пользователя itpro будет создан каталог publish. Давайте в этом убедимся дав команду `ls` в домашнем
каталоге пользователя itpro на сервере Ubuntu.

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI11.png){ border-effect="line"}

Давайте перейдем в каталог **publish** на сервере Ubuntu и попробуем запустить программу. Приложение зависящее от платформы
должно запускаться командой `dotnet <filename.dll>`. Треугольные скобки это общепринятый способ обозначения подставляемого 
значения. Причем в реальной команде треугольные скобки не используются. То есть реальная команда для запуска нашего приложения
будет выглядеть так:

`dotnet ex0006VSCodeProject02.dll`

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI12.png){ border-effect="line"  thumbnail="true" width="700"}

Как видите приложение не запустилось, поскольку у нас не установлен .NET Runtime. У нас есть два выхода из этого положения.
Установить .NET SDK, содержащий .NET Runtime, или установить только .NET Runtime. Если мы не собираемся разрабатывать 
программы на сервере Ubuntu, а только запускать их, то нам не нужен .NET SDK, а нужен только .NET Runtime. К тому же
.NET Runtime гораздо меньше по размеру. Поэтому мы установим только его, чтобы запустить нашу программу.

Как видно на скриншоте Ubuntu нам даже подсказывает, что можно сделать, но как я уже сказал .NET SDK нам не нужен. Поэтому
[установим .NET Runtime](https://learn.microsoft.com/ru-ru/dotnet/core/install/linux-ubuntu-2204#install-the-runtime) командой:

`sudo apt install -y dotnet-runtime-8.0`

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI13.png){ border-effect="line"  thumbnail="true" width="700"}

Обратите внимание, поскольку у нас консольное приложение, то мы установили минимальную по объему и функциям версию .NET Runtime.
Другим вариантом было бы установить **aspnetcore-runtime-8.0**, для поддержки веб приложений, но сейчас нам это не нужно.
Хотя если бы мы установили **aspnetcore-runtime-8.0**, наше приложение всё равно бы работало, так как **aspnetcore-runtime-8.0**
включает в себя **dotnet-runtime-8.0**.

В процессе установки вы можете получить парочку подобных сообщений:

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI14.png){ border-effect="line"  thumbnail="true" width="700"}

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI15.png){ border-effect="line"  thumbnail="true" width="700"}

Это нам сообщают, что надо бы обновить ядро и перезагрузиться. Если вы получили подобные сообщения, то дайте эту парочку 
команд:

`sudo apt update && sudo apt upgrade -y`

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI16.png){ border-effect="line"  thumbnail="true" width="700"}

И перезагрузите сервер командой `sudo reboot now`

После перезагрузки давайте убедимся что у нас установлен .NET Runtime командой `dotnet --info`.

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI17.png){ border-effect="line"  thumbnail="true" width="700"}

И затем перейдем в каталог publish и запустим нашу программу.

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI18.png){ border-effect="line"  thumbnail="true" width="700"}

Как видите всё работает! Кстати наше автономное приложение тоже будет работать.

Если у вас нет виртуального сервера Ubuntu, то вы все равно можете проверить работу, обоих приложений в WSL. Хотя в нашем
случае в WSL уже установлен .NET SDK. Поэтому проверить работу автономного приложения мы можем очень относительно, так
как правильнее было бы, чтобы в WSL не был установлен .NET SDK или .NET Runtime, дабы проверить работу обоих вариантов 
публикации.

Но так или иначе давайте запустим опубликованное нами зависимое от среды исполнения приложение. В случае WSL, так как 
все на одной машине, не нужно ни куда забрасывать файлы, так как достаточно просто перейти в каталог с публикацией.
Запускаем WSL и вперёд!

Все команды показаны стрелочками. Вы уже должны их уже хорошо знать, ну или по крайней мере узнавать.

![Публикация приложения C# средствами CLI](PublishCSharpProjectByCLI19.png){ border-effect="line"  thumbnail="true" width="700"}

Как видите и в WSL всё работает, поскольку это самая настоящая Ubuntu.

Надеюсь у вас всё получилось! Или хотя бы вы всё более-менее поняли. Но даже если это не так, то не беда. Со временем
всё станет понятно.
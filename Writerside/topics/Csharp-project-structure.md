# Структура проекта C#

Мы уже немного говорили на эту тему [тут](Install-Visual-Studio-Code-in-Windows.md#csharp_files_and_folders). Сейчас мы 
немного больше углубимся в эту тему. И начнем сразу с практики. Создайте проект `ex0012_default_namespaces` в JetBrains Rider.
Проект должен быть в решении episode02.

![Создание проекта в JetBrains Rider](NameSpaces01.png){ border-effect="line"  thumbnail="true" width="700" }

В результате у вас должно получиться что-то вроде такого:

![Проекты в JetBrains Rider](NameSpaces02.png){ border-effect="line"  thumbnail="true" width="700" }

Был создан проект с операторами верхнего уровня, так как при создании мы не отметили галку **Do not user top-level statements**.

Классические программы C# до .NET 6.0 должны были использовать инструкцию `using` для импорта пространств имен включающих
стандартные библиотеки C#, такие, как например `System`.

Первые строки любого файла .cs могли выглядеть например так:

```c#
using System;
using System.Linq;
using System.Collections.Generic;
```
Как я уже говорил эти инструкции подключают к вашей программе стандартные библиотеки, которые содержат множество готовых
полезных методов, таких как например `WriteLine`, выводящих сообщение в консоль. То есть вам не надо изобретать велосипед,
а можно пользоваться уже готовым кодом, который написали для вас другие программисты.

Чтобы ваша программа могла найти метод `WriteLine`, ей надо объяснить где он находится. Это примерно как адрес дома, на 
улице и в городе. На самом деле метод `WriteLine` является частью класса `Console`, который в свою очередь входит в 
пространство имен `System`. Тут можно провести аналогию, что `System` - это город, `Console` - это улица, а `WriteLine` - 
это дом.

После подключения пространств имен, программа сама ищет класс и метод в объявленных пространствах имен.

Если бы, например, инструкции `using System` не было то, чтобы вызвать метод `WriteLine` необходимо было быть написать 
инструкцию:

```c#
System.Console.WriteLine("Hello World")
```

Согласитесь что это не очень удобно.

И по аналогии с городами, улицами и домами можно добавить. Что в разных городах могут быть улицы с одинаковыми названиями,
а так же дома с одинаковыми номерами. Помните комедию "Ирония судьбы, или С легким паром"?

Поскольку разные программисты могут для своих классов и методов выбрать одинаковые названия, то для этого были созданы 
пространства имен.

По умолчанию для проекта задается пространство имен по имени проекта. Мы кстати это тоже уже проходили [тут](Install-Visual-Studio-Code-in-Windows.md#add_second_project_to_solution).
Хотя конечно тоже вскользь. Освежите в памяти если забыли.

Таким образом каждый проект, по умолчанию, имеет свое пространство имен. Но чтобы пользоваться другими методами из стандартной,
или другой подключенной библиотеки, необходимо импортировать её пространство имен.

В случае стандартной библиотеки входящей в SDK достаточно просто команды `using` с указанием пространства имен. 

В случае сторонней библиотеки необходим как сам файл библиотеки, так и команда `using`.

**Начиная с .NET 6.0 и соответственно с версии языка C#10 любые проекты используют неявный глобальный импорт некоторых пространств имен.**

Список неявно импортируемых пространств имен зависит от типа создаваемого проекта (шаблона). Про шаблоны мы кстати тоже говорили [тут](how-to-crate-csharp-windows-command-line.md#template_list).

Кроме того появилась инструкция `global using`, которая позволяет импортировать пространство имен только в одном файле .cs, и оно будет 
доступно во всех файлах .cs проекта.

## Неявный глобальный импорт пространств имен

Теперь мы посмотрим какие пространства имен (namespaces) были импортированы нашей программой. Кстати это мы уже делали
[тут](how-to-crate-csharp-windows-command-line.md#RiderDefaultNamespace). Рекомендую освежить это в памяти.

На скриншоте выше вы видите фигурные скобки в области нумерации строк у первой строки. Наведите на нее мышь.

![Проекты в JetBrains Rider](NameSpaces03.png){ border-effect="line"  thumbnail="true" width="700" }

Вы должны увидеть подсказку **Global 'using' directives**. Как раз о глобальном явном и неявном импортах мы сейчас и будем
говорить.

Далее кликните по этим фигурным скобкам мышкой. И вы должны увидеть следующее:

![Проекты в JetBrains Rider](NameSpaces04.png){ border-effect="line"  thumbnail="true" width="700" }

Ну можно сказать преступление раскрыто! Мы вышли на след файла где неявно импортируются пространства имен. Этот файл
создается в подкаталоге obj/Debug/net8.0 во время создания проекта автоматически. Имя файла всегда стандартное. 
Сперва идет имя проекта, потом точка, а за ним **GlobalUsings.g.cs**.

Давайте посмотрим на этот файл и его сообщников. Для этого кликнем в правом верхнем углу по стрелке вниз рядом со словом 
Solution и выберем File system. 

![Проекты в JetBrains Rider](NameSpaces05.png){ border-effect="line"  thumbnail="true" width="700" }

Далее разверните каталоги obj/Debug/net8.0 и откройте в редакторе файл **ex0012_default_namespaces.GlobalUsings.g.cs**.

![Проекты в JetBrains Rider](NameSpaces06.png){ border-effect="line"  thumbnail="true" width="700" }

И вот они наши голубчики неявные импорты где порылися. Но для простого консольного приложения выводящего одну строку
многие из этих библиотек не нужны. Давайте уберем не нужные. Но хочу напомнить, что этот файл создается автоматически.
Поэтому нам надо отредактировать файл нашего проекта **ex0012_default_namespaces.csproj** и привести его к следующему виду:

```xml
<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <OutputType>Exe</OutputType>
        <TargetFramework>net8.0</TargetFramework>
        <ImplicitUsings>enable</ImplicitUsings>
        <Nullable>enable</Nullable>
    </PropertyGroup>

    <ItemGroup>
        <Using Remove="System.Threading" />
        <Using Remove="System.Collections.Generic" />
        <Using Remove="System.Linq" />
        <Using Remove="System.Net.Http" />
        <Using Remove="System.Threading" />
        <Using Remove="System.Threading.Tasks" />
    </ItemGroup>

</Project>
```

Файл проекта **ex0012_default_namespaces.csproj** - это файл в формате XML.

>XML (eXtensible Markup Language) — это текстовый формат для хранения данных, который легко читается как человеком
>, так и компьютером. Если говорить простыми словами, XML — это способ структурировать информацию в виде текста с
> использованием тегов, похожих на HTML, но с возможностью создавать свои собственные теги.
{style="note"}

![Удаляем не нужные global using](NameSpaces07.png){ border-effect="line"  thumbnail="true" width="700" }

С помощью тегов `Using Remove` в группе `ItemGroup` мы удалили не нужные нам неявные глобальные импорты.

Сохраните файл проекта, и посмотрите как изменился файл **ex0012_default_namespaces.GlobalUsings.g.cs**:

![Удаляем не нужные global using](NameSpaces08.png){ border-effect="line"  thumbnail="true" width="700" }

Для контрольного выстрела, перейдите в файл Program.cs и снова кликните по фигурным скобкам. Вы должны увидеть следующее:

![Удаляем не нужные global using](NameSpaces09.png){ border-effect="line"  thumbnail="true" width="700" }

Запустите программу и убедитесь что она работает. Как это сделать можете вспомнить [тут](Install-JetBrains-Rider-in-Windows.md#rider_run).

## Отключение неявного глобального импорта для проекта
Согласитесь, что если вам в консольном приложении не нужны все эти библиотеки, то писать для удаления каждой отдельный тэг
это не очень весело. К тому же в других шаблонах библиотек может быть гораздо больше. И удалять каждую поодиночке не очень.

Убрать неявный импорт можно либо вообще удалив элемент `<ImplicitUsings>enable</ImplicitUsings>`, или изменить его значение
на `disable`, то есть привести его к виду `<ImplicitUsings>disable</ImplicitUsings>`. А затем импортировать только нужные
пространства имен.

